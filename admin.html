<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <meta name="color-scheme" content="dark" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="INFINITEX" />
  <meta name="robots" content="noindex, nofollow" />

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="assets/icons/icon-192.png" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png" />
  <title>INFINITEX — لوحة الإدارة</title>
  <meta name="description" content="لوحة إدارة المحتوى والصلاحيات لموقع خدمات INFINITEX." />

  <link rel="preload" href="assets/fonts/avenir-black-arabic.otf" as="font" type="font/otf" crossorigin>

  <style>
    @font-face{font-family:"AvenirBlackArabic"; src:url("assets/fonts/avenir-black-arabic.otf") format("opentype"); font-display:swap;}
    :root{--bg:#050607;--bg2:#0a0c0d;--text:#eef2f3;--muted:#a7b0b5;--muted2:#7d878d;--line:rgba(255,255,255,.08);--accent:#39ff14;--shadow:0 24px 80px rgba(0,0,0,.55);--radius:18px;--radius2:24px;--max:1120px;}
    *{box-sizing:border-box}
    html,body{height:100%}
    html{background:#000}
    body{margin:0;color:var(--text);background:radial-gradient(1100px 560px at 80% -10%, rgba(57,255,20,.18), transparent 60%),linear-gradient(180deg,var(--bg) 0%,var(--bg2) 100%);font-family:"AvenirBlackArabic",system-ui,-apple-system,"Segoe UI",Arial,sans-serif;overflow-x:hidden;}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:var(--max);margin:0 auto;padding:0 18px}
    .chip{display:inline-flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--line);background:rgba(255,255,255,.03);border-radius:999px;color:var(--muted);font-size:13px}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--accent);box-shadow:0 0 18px rgba(57,255,20,.6)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:14px 16px;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.02);color:var(--text);cursor:pointer;transition:transform .15s ease,border-color .15s ease;user-select:none;font-weight:800}
    .btn:hover{transform:translateY(-1px);border-color:rgba(57,255,20,.45)}
    .btn.primary{background:linear-gradient(180deg, rgba(57,255,20,.95), rgba(43,220,18,.85));border-color:rgba(57,255,20,.65);color:#061006;box-shadow:0 18px 60px rgba(57,255,20,.18)}
    .btn.ghost{border-color:rgba(255,255,255,.10)}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}

    header{position:sticky; top:0;  z-index:50; backdrop-filter: blur(14px); background:#000; padding-top: env(safe-area-inset-top); border-bottom:1px solid rgba(255,255,255,.08)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:16px 0}
    .brand{display:flex;align-items:center;gap:12px;min-width:160px}
    .brand img{height:22px;opacity:.98}
    .navlinks{display:flex;align-items:center;gap:10px}
    .navlinks a{padding:10px 10px;border-radius:12px;border:1px solid transparent;color:var(--muted);font-size:13px}
    .navlinks a:hover{border-color:rgba(255,255,255,.10);color:var(--text)}
    .navlinks a.active{border-color:rgba(57,255,20,.35);color:var(--text)}
    .navCtas{display:flex;gap:10px;align-items:center}

    .hero{padding:18px 0 8px}
    .heroCard{padding:18px;border-radius:var(--radius2);position:relative;overflow:hidden}
    .heroCard::before{content:"";position:absolute;inset:-1px;background:radial-gradient(700px 350px at 70% 0%, rgba(57,255,20,.18), transparent 60%);opacity:.9;pointer-events:none}
    .heroGrid{position:relative;display:grid;gap:16px}
    .h1{position:relative;font-size:clamp(24px,7.2vw,46px);line-height:1.05;margin:12px 0 10px}
    .p{position:relative;margin:0;color:var(--muted);font-size:14px;line-height:1.85}

    .section{padding:16px;border-radius:var(--radius);border:1px solid rgba(255,255,255,.08);background:rgba(0,0,0,.22)}
    .section h2{margin:0 0 12px;font-size:18px}
    .section p{margin:0 0 12px;color:var(--muted);font-size:13px;line-height:1.8}

    .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .field{display:grid;gap:8px}
    label{font-size:12px;color:var(--muted2)}
    input,textarea,select{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.25);color:var(--text);outline:none;font-family:inherit;font-size:13px}
    textarea{min-height:96px;resize:vertical}
    input:focus,textarea:focus,select:focus{border-color:rgba(57,255,20,.45)}

    .toggle{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.02);gap:10px}
    .toggle span{font-size:13px;color:var(--text)}
    .toggle small{color:var(--muted2);font-size:11px}

    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .status{font-size:12px;color:var(--muted2)}

    .note{margin-top:14px;padding:12px;border-radius:16px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);font-size:12px;line-height:1.8;color:var(--muted)}

    .authGate{
      position:fixed;
      inset:0;
      z-index:90;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(5,6,7,.92);
      padding:18px;
    }
    .authCard{
      max-width:420px;
      width:100%;
      padding:22px;
      border-radius:var(--radius2);
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.35);
      box-shadow:var(--shadow);
      text-align:center;
    }
    .authCard h2{margin:0 0 8px;font-size:20px}
    .authCard p{margin:0 0 14px;color:var(--muted);font-size:13px;line-height:1.8}
    .authRow{display:grid;gap:10px}
    .authRow input{font-size:14px}
    .authError{color:#ffb4b4;font-size:12px;display:none}
    .authError.show{display:block}
    body.locked header,
    body.locked main,
    body.locked footer,
    body.locked .mobileNav{filter:blur(6px);pointer-events:none;user-select:none}

    footer{padding:26px 0 110px;color:var(--muted2);font-size:12px; background:#000}

    .mobileNav{position:fixed;left:12px;right:12px;bottom: calc(12px + env(safe-area-inset-bottom));z-index:70;display:none}
    .mobileNavBar{display:flex;gap:8px;align-items:stretch;justify-content:space-between;border-radius:18px;border:1px solid rgba(255,255,255,.10);background:rgba(5,6,7,.78);backdrop-filter:blur(12px);padding:8px}
    .mnItem{flex:1;padding:10px 8px;border-radius:14px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.02);color:var(--muted);font-size:12px;text-align:center;white-space:nowrap}
    .mnItem.active{border-color:rgba(57,255,20,.35);color:var(--text)}
    .mnItem.store{color:#061006;background:rgba(57,255,20,.90);border-color:rgba(57,255,20,.75)}

    @media (max-width:980px){.navlinks{display:none}.navCtas{display:none}.mobileNav{display:block}body{padding-bottom:96px}}
    @media (max-width:520px){body{background:linear-gradient(180deg,var(--bg) 0%, #07090a 100%) !important;}.wrap{padding:0 14px}.brand img{height:20px}}
  </style>
  <script src="assets/js/ix-live-content.js" defer></script>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="nav">
        <div class="brand" aria-label="INFINITEX">
          <a href="index.html" aria-label="الرئيسية"><img src="assets/brands/infinitex-logo.png" alt="INFINITEX" data-ix-src="global.media.infinitexLogo" /></a>
          <span class="chip" id="ix-afterSalesChip" data-ix-chip="global.chipAfterSales"><span class="dot"></span> خدمات ما بعد البيع</span>
        </div>

        <nav class="navlinks" aria-label="التنقل">
          <a href="index.html" data-ix-text="global.nav.home" data-ix-permission="permissions.showHome">الرئيسية</a>
          <a href="track.html" data-ix-text="global.nav.track" data-ix-permission="permissions.showTrack">تتبع الطلب</a>
          <a href="returns.html" data-ix-text="global.nav.returns" data-ix-permission="permissions.showReturns">الاسترجاع</a>
          <a href="products.html" data-ix-text="global.nav.products" data-ix-permission="permissions.showProducts">المنتجات</a>
          <a class="active" href="admin.html" data-ix-text="global.nav.admin" data-ix-permission="permissions.showAdmin">لوحة الإدارة</a>
        </nav>

        <div class="navCtas">
          <a class="btn ghost" href="https://infinitex.sa/blogs/gold-warranty-policy" target="_blank" rel="noopener" data-ix-href="global.links.warrantyPolicy" data-ix-text="global.nav.policy" data-ix-permission="permissions.showPolicyCta">سياسة الضمان الذهبي</a>
          <a class="btn primary" href="https://infinitex.sa/" target="_blank" rel="noopener" data-ix-href="global.links.store" data-ix-text="global.nav.store" data-ix-permission="permissions.showStoreCta">المتجر</a>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap hero">
    <section class="heroCard card">
      <div class="chip" style="position:relative"><span class="dot"></span> لوحة إدارة المحتوى والصلاحيات</div>
      <h1 class="h1">تحكم كامل في النصوص والصلاحيات والمحتوى</h1>
      <p class="p">هذه اللوحة تعطيك نسخة قابلة للحفظ من ملف المحتوى. عدّل القيم، فعّل الصلاحيات أو عطّلها، ثم احفظ الإعدادات أو صدّر ملف JSON لرفعه على الخادم.</p>

      <div class="heroGrid">
        <section class="section">
          <h2>الصلاحيات</h2>
          <p>فعّل أو عطّل ظهور الصفحات وروابط الهيدر والزر الرئيسي للمتجر.</p>
          <div class="grid" id="permissionsGrid"></div>
        </section>

        <section class="section">
          <h2>النصوص والمحتوى</h2>
          <p>عدّل عناوين الصفحات، النصوص التعريفية، والنصوص الدعائية.</p>
          <div class="grid" id="contentGrid"></div>
        </section>

        <section class="section">
          <h2>روابط وصور</h2>
          <p>عدّل روابط المتجر والسياسة وروابط الصور الأساسية.</p>
          <div class="grid" id="linksGrid"></div>
        </section>

        <section class="section">
          <h2>الإجراءات</h2>
          <p>احفظ التعديلات محليًا داخل المتصفح أو صدّر الملف النهائي.</p>
          <div class="actions">
            <button class="btn primary" type="button" id="saveBtn">حفظ محليًا</button>
            <button class="btn" type="button" id="downloadBtn">تصدير JSON</button>
            <button class="btn ghost" type="button" id="clearBtn">مسح الإعدادات المحلية</button>
            <label class="btn ghost" for="uploadInput">استيراد JSON</label>
            <input type="file" id="uploadInput" accept="application/json" hidden />
          </div>
          <div class="status" id="statusText">آخر تحديث: لم يتم الحفظ بعد.</div>
          <div class="note">نصيحة: التعديلات تحفظ محليًا فقط حتى تقوم برفع ملف JSON للموقع. يمكنك معاينة التغييرات فورًا بفتح أي صفحة أخرى في تبويب جديد.</div>
        </section>
      </div>
    </section>
  </main>

  <div class="authGate" id="authGate" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <div class="authCard">
      <div class="chip" style="justify-content:center"><span class="dot"></span> وصول مقيد</div>
      <h2 id="authTitle">لوحة الإدارة محمية</h2>
      <p>الرجاء إدخال كلمة المرور للوصول إلى أدوات التحكم. لن تظهر هذه الصفحة للعملاء أو لمحركات البحث.</p>
      <div class="authRow">
        <input type="password" id="adminPassword" placeholder="كلمة المرور" autocomplete="current-password" />
        <button class="btn primary" type="button" id="unlockBtn">فتح اللوحة</button>
        <div class="authError" id="authError">كلمة المرور غير صحيحة.</div>
      </div>
    </div>
  </div>

  <footer>
    <div class="wrap">
      <div style="border-top:1px solid rgba(255,255,255,.08); padding-top: 14px">
      <div>© <span id="year"></span> INFINITEX — لوحة الإدارة</div>
    </div>
    </div>
  </footer>

  <div class="mobileNav" role="navigation" aria-label="تنقل سريع">
    <div class="mobileNavBar">
      <a class="mnItem" href="index.html" data-ix-text="global.mobileNav.services" data-ix-permission="permissions.showHome">خدمات</a>
      <a class="mnItem" href="track.html" data-ix-text="global.mobileNav.track" data-ix-permission="permissions.showTrack">تتبع</a>
      <a class="mnItem" href="returns.html" data-ix-text="global.mobileNav.returns" data-ix-permission="permissions.showReturns">استرجاع</a>
      <a class="mnItem" href="products.html" data-ix-text="global.mobileNav.products" data-ix-permission="permissions.showProducts">منتجات</a>
      <a class="mnItem active" href="admin.html" data-ix-text="global.mobileNav.admin" data-ix-permission="permissions.showAdmin">إدارة</a>
    </div>
  </div>

  <script>
    const DEFAULT_CONTENT_URL = 'content.json';
    const STORAGE_KEY = 'IX_CONTENT_OVERRIDE';
    const AUTH_ENDPOINT = '/api/auth';

    const setLocked = (locked) => {
      document.body.classList.toggle('locked', locked);
      document.getElementById('authGate').style.display = locked ? 'flex' : 'none';
      if (!locked) {
        document.getElementById('adminPassword').value = '';
        document.getElementById('authError').classList.remove('show');
      }
    };

    const checkSession = async () => {
      try {
        const res = await fetch(AUTH_ENDPOINT, { credentials: 'include', cache: 'no-store' });
        if (!res.ok) return false;
        const data = await res.json();
        return Boolean(data && data.authorized);
      } catch (error) {
        return false;
      }
    };

    const permissionFields = [
      { path: 'permissions.showHome', label: 'إظهار الرئيسية', hint: 'روابط الرئيسية في الهيدر والتنقل السفلي.' },
      { path: 'permissions.showTrack', label: 'إظهار صفحة التتبع', hint: 'التحكم في رابط تتبع الطلب.' },
      { path: 'permissions.showReturns', label: 'إظهار صفحة الاسترجاع', hint: 'التحكم في رابط الاسترجاع.' },
      { path: 'permissions.showProducts', label: 'إظهار صفحة المنتجات', hint: 'إظهار صفحة المنتجات التشويقية.' },
      { path: 'permissions.showAdmin', label: 'إظهار لوحة الإدارة', hint: 'إظهار رابط لوحة الإدارة.' },
      { path: 'permissions.showStoreCta', label: 'إظهار زر المتجر', hint: 'زر المتجر في الهيدر.' },
      { path: 'permissions.showPolicyCta', label: 'إظهار زر السياسة', hint: 'زر سياسة الضمان الذهبي.' }
    ];

    const contentFields = [
      { path: 'global.chipAfterSales', label: 'شارة خدمات ما بعد البيع', type: 'text' },
      { path: 'global.nav.home', label: 'نص الرئيسية', type: 'text' },
      { path: 'global.nav.track', label: 'نص التتبع', type: 'text' },
      { path: 'global.nav.returns', label: 'نص الاسترجاع', type: 'text' },
      { path: 'global.nav.products', label: 'نص المنتجات', type: 'text' },
      { path: 'global.nav.admin', label: 'نص الإدارة', type: 'text' },
      { path: 'global.nav.policy', label: 'نص سياسة الضمان', type: 'text' },
      { path: 'global.nav.store', label: 'نص المتجر', type: 'text' },
      { path: 'pages.index.badge', label: 'شارة الرئيسية', type: 'text' },
      { path: 'pages.index.title', label: 'عنوان الرئيسية', type: 'textarea' },
      { path: 'pages.index.desc', label: 'وصف الرئيسية', type: 'textarea' },
      { path: 'pages.index.ctaTrack', label: 'زر التتبع في الرئيسية', type: 'text' },
      { path: 'pages.index.ctaReturns', label: 'زر الاسترجاع في الرئيسية', type: 'text' },
      { path: 'pages.index.note', label: 'تنبيه الرئيسية', type: 'textarea' },
      { path: 'pages.track.badge', label: 'شارة التتبع', type: 'text' },
      { path: 'pages.track.title', label: 'عنوان التتبع', type: 'textarea' },
      { path: 'pages.track.desc', label: 'وصف التتبع', type: 'textarea' },
      { path: 'pages.track.intro', label: 'رسالة الترحيب بالتتبع', type: 'textarea' },
      { path: 'pages.track.orderPlaceholder', label: 'تلميح رقم الطلب', type: 'text' },
      { path: 'pages.track.cta', label: 'زر التتبع', type: 'text' },
      { path: 'pages.track.hint', label: 'تنبيه التتبع', type: 'textarea' },
      { path: 'pages.track.openChat', label: 'رابط فتح الشات', type: 'text' },
      { path: 'pages.returns.badge', label: 'شارة الاسترجاع', type: 'text' },
      { path: 'pages.returns.title', label: 'عنوان الاسترجاع', type: 'textarea' },
      { path: 'pages.returns.desc', label: 'وصف الاسترجاع', type: 'textarea' },
      { path: 'pages.returns.formTitle', label: 'عنوان النموذج', type: 'text' },
      { path: 'pages.returns.orderLabel', label: 'تسمية رقم الطلب', type: 'text' },
      { path: 'pages.returns.orderPlaceholder', label: 'تلميح رقم الطلب', type: 'text' },
      { path: 'pages.returns.phoneLabel', label: 'تسمية الجوال', type: 'text' },
      { path: 'pages.returns.phonePlaceholder', label: 'تلميح الجوال', type: 'text' },
      { path: 'pages.returns.cta', label: 'زر الاسترجاع', type: 'text' },
      { path: 'pages.returns.policyCta', label: 'زر السياسة', type: 'text' },
      { path: 'pages.returns.helper', label: 'إرشاد الاسترجاع', type: 'textarea' },
      { path: 'pages.returns.footerTitle', label: 'عنوان قسم الاسترجاع', type: 'text' },
      { path: 'pages.products.headerChip', label: 'شارة المنتجات', type: 'text' },
      { path: 'pages.products.badge', label: 'شارة المنتج', type: 'text' },
      { path: 'pages.products.title', label: 'عنوان المنتجات', type: 'text' },
      { path: 'pages.products.desc', label: 'وصف المنتجات', type: 'textarea' },
      { path: 'pages.products.ctaStore', label: 'زر المتجر في المنتجات', type: 'text' }
    ];

    const linkFields = [
      { path: 'global.links.store', label: 'رابط المتجر', type: 'text' },
      { path: 'global.links.warrantyPolicy', label: 'رابط سياسة الضمان', type: 'text' },
      { path: 'global.media.infinitexLogo', label: 'مسار شعار INFINITEX', type: 'text' },
      { path: 'global.media.yammLogo', label: 'مسار شعار Yamm', type: 'text' },
      { path: 'pages.index.heroImage', label: 'صورة هيرو الرئيسية', type: 'text' }
    ];

    const setValue = (obj, path, value) => {
      const keys = path.split('.');
      const lastKey = keys.pop();
      const target = keys.reduce((acc, key) => {
        if (!acc[key]) {
          acc[key] = {};
        }
        return acc[key];
      }, obj);
      target[lastKey] = value;
    };

    const getValue = (obj, path) => path.split('.').reduce((acc, key) => (acc ? acc[key] : undefined), obj);

    const renderPermissions = (content) => {
      const grid = document.getElementById('permissionsGrid');
      grid.innerHTML = '';
      permissionFields.forEach((field) => {
        const wrapper = document.createElement('label');
        wrapper.className = 'toggle';
        const info = document.createElement('div');
        const title = document.createElement('span');
        title.textContent = field.label;
        const hint = document.createElement('small');
        hint.textContent = field.hint;
        info.appendChild(title);
        info.appendChild(hint);
        const input = document.createElement('input');
        input.type = 'checkbox';
        input.checked = Boolean(getValue(content, field.path));
        input.dataset.path = field.path;
        wrapper.appendChild(info);
        wrapper.appendChild(input);
        grid.appendChild(wrapper);
      });
    };

    const renderFields = (content, fields, containerId) => {
      const grid = document.getElementById(containerId);
      grid.innerHTML = '';
      fields.forEach((field) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'field';
        const label = document.createElement('label');
        label.textContent = field.label;
        let input;
        if (field.type === 'textarea') {
          input = document.createElement('textarea');
        } else {
          input = document.createElement('input');
          input.type = 'text';
        }
        input.value = getValue(content, field.path) ?? '';
        input.dataset.path = field.path;
        wrapper.appendChild(label);
        wrapper.appendChild(input);
        grid.appendChild(wrapper);
      });
    };

    const collectContent = (base) => {
      const updated = JSON.parse(JSON.stringify(base));
      document.querySelectorAll('[data-path]').forEach((input) => {
        if (input.type === 'checkbox') {
          setValue(updated, input.dataset.path, input.checked);
          return;
        }
        setValue(updated, input.dataset.path, input.value.trim());
      });
      return updated;
    };

    const updateStatus = (text) => {
      document.getElementById('statusText').textContent = text;
    };

    const loadContent = async () => {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          return parsed;
        } catch (error) {
          updateStatus('تعذر قراءة النسخة المحلية، تم تحميل النسخة الافتراضية.');
        }
      }
      const res = await fetch(DEFAULT_CONTENT_URL, { cache: 'no-store' });
      return await res.json();
    };

    const init = async () => {
      const content = await loadContent();
      renderPermissions(content);
      renderFields(content, contentFields, 'contentGrid');
      renderFields(content, linkFields, 'linksGrid');
      updateStatus('تم تحميل البيانات بنجاح.');
    };

    document.getElementById('saveBtn').addEventListener('click', () => {
      loadContent().then((content) => {
        const updated = collectContent(content);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(updated, null, 2));
        updateStatus('تم حفظ الإعدادات محليًا. افتح الصفحات الأخرى لمعاينة التحديثات.');
      });
    });

    document.getElementById('unlockBtn').addEventListener('click', async () => {
      const password = document.getElementById('adminPassword').value.trim();
      const error = document.getElementById('authError');
      if (!password) {
        error.classList.add('show');
        return;
      }
      try {
        const res = await fetch(AUTH_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ password })
        });
        if (!res.ok) {
          error.classList.add('show');
          return;
        }
        const data = await res.json();
        if (data && data.authorized) {
          setLocked(false);
        } else {
          error.classList.add('show');
        }
      } catch (errorResponse) {
        error.classList.add('show');
      }
    });

    document.getElementById('adminPassword').addEventListener('keydown', (event) => {
      if (event.key === 'Enter') {
        document.getElementById('unlockBtn').click();
      }
    });

    document.getElementById('adminPassword').addEventListener('input', () => {
      document.getElementById('authError').classList.remove('show');
    });

    document.getElementById('downloadBtn').addEventListener('click', () => {
      loadContent().then((content) => {
        const updated = collectContent(content);
        const blob = new Blob([JSON.stringify(updated, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const anchor = document.createElement('a');
        anchor.href = url;
        anchor.download = 'content.json';
        anchor.click();
        URL.revokeObjectURL(url);
        updateStatus('تم تصدير ملف المحتوى.');
      });
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      localStorage.removeItem(STORAGE_KEY);
      updateStatus('تم مسح الإعدادات المحلية. سيتم استخدام النسخة الافتراضية.');
    });

    document.getElementById('uploadInput').addEventListener('change', (event) => {
      const [file] = event.target.files;
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const parsed = JSON.parse(reader.result);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed, null, 2));
          updateStatus('تم استيراد الملف بنجاح.');
          init();
        } catch (error) {
          updateStatus('تعذر استيراد الملف. تأكد من صيغة JSON.');
        }
      };
      reader.readAsText(file);
    });

    document.getElementById('year').textContent = new Date().getFullYear();
    checkSession().then((authorized) => {
      setLocked(!authorized);
      init();
    });
  </script>
</body>
</html>
