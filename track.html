<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <meta name="color-scheme" content="dark" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="INFINITEX" />

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="assets/icons/icon-192.png" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png" />
  <title>INFINITEX â€” ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</title>
  <meta name="description" content="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø·Ù„Ø¨Ùƒ ÙˆØ³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø¥Ø¸Ù‡Ø§Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØªØ¨Ø¹ Ø¨Ø´ÙƒÙ„ ÙÙˆØ±ÙŠ." />

  <link rel="preload" href="assets/fonts/avenir-black-arabic.otf" as="font" type="font/otf" crossorigin>

  <style>
    @font-face {
      font-family: "AvenirBlackArabic";
      src: url("assets/fonts/avenir-black-arabic.otf") format("opentype");
      font-display: swap;
    }

    :root {
      --bg: #050607;
      --text: #eef2f3;
      --muted: #a7b0b5;
      --muted2: #7d878d;
      --line: rgba(255,255,255,.08);
      --accent: #39ff14;
      --accent2: #2bdc12;
      --gold: #ffd700;
      --red: #ff4757;
      --radius: 20px;
      --max: 700px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; background: #000; overflow-x: hidden; max-width: 100vw; }

    body {
      font-family: "AvenirBlackArabic", system-ui, sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, var(--bg) 0%, #07090a 100%);
      overflow-x: hidden;
      max-width: 100vw;
      line-height: 1.7;
      -webkit-font-smoothing: antialiased;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes shimmer { 0% { background-position: -200% center; } 100% { background-position: 200% center; } }
    @keyframes floatUp { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
    @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image:
        radial-gradient(circle at 20% 50%, rgba(57,255,20,.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(57,255,20,.02) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
      animation: gradientShift 15s ease infinite;
      background-size: 200% 200%;
    }

    body > * { position: relative; z-index: 1; }

    .animate { animation: fadeIn 0.5s ease forwards; opacity: 0; }
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }

    .wrap { max-width: var(--max); margin: 0 auto; padding: 0 16px; }
    section { padding: 40px 0; }

    .h1 { font-size: clamp(24px, 7vw, 40px); line-height: 1.15; }
    .h2 { font-size: clamp(20px, 5.5vw, 28px); line-height: 1.2; margin-bottom: 12px; }
    .h3 { font-size: clamp(16px, 4.5vw, 20px); line-height: 1.3; }
    .p { color: var(--muted); font-size: 14px; line-height: 1.85; }

    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(0,0,0,.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--line);
    }
    .nav { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; }
    .brand img { height: 20px; }
    .navlinks { display: flex; gap: 6px; }
    .navlinks a { padding: 8px 12px; border-radius: 10px; color: var(--muted); font-size: 12px; text-decoration: none; }
    .navlinks a:hover, .navlinks a.active { color: var(--text); background: rgba(255,255,255,.05); }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      animation: pulse 2s infinite;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 24px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      width: 100%;
    }

    .btn:hover { transform: translateY(-2px); border-color: rgba(57,255,20,.4); }

    .btn.primary {
      background: linear-gradient(180deg, rgba(57,255,20,.95), rgba(43,220,18,.85));
      border-color: rgba(57,255,20,.6);
      color: #061006;
    }

    .btn.ghost { background: transparent; }

    .btn-row { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }

    .card {
      background: rgba(255,255,255,.02);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 24px 20px;
      margin-bottom: 16px;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .feature-card {
      background: rgba(0,0,0,.3);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 20px 16px;
      transition: all 0.3s;
    }

    .feature-card:hover {
      border-color: rgba(57,255,20,.2);
      transform: translateY(-2px);
    }

    .feature-card .emoji {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .feature-card h3 {
      font-size: 15px;
      margin-bottom: 8px;
    }

    .feature-card p {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.8;
    }

    .hero {
      text-align: center;
      padding: 30px 0 40px;
      position: relative;
    }

    .hero::before {
      content: "";
      position: absolute;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      width: 500px;
      height: 400px;
      background: radial-gradient(circle, rgba(57,255,20,.12) 0%, transparent 60%);
      pointer-events: none;
    }

    .hero-content { position: relative; z-index: 1; }

    .hero-subtitle {
      font-size: clamp(16px, 4.5vw, 22px);
      color: var(--muted);
      margin: 8px 0 16px;
    }

    .hero-desc {
      font-size: 14px;
      color: var(--muted);
      max-width: 500px;
      margin: 0 auto 20px;
      line-height: 1.9;
    }

    .section-header {
      text-align: center;
      margin-bottom: 24px;
    }

    .form-card {
      background: rgba(0,0,0,.4);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 24px 20px;
    }

    .chat-log {
      height: min(52vh, 520px);
      overflow: auto;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      padding: 12px;
      scrollbar-width: thin;
    }

    .msg {
      max-width: 92%;
      padding: 10px 12px;
      border-radius: 14px;
      margin: 8px 0;
      font-size: 13px;
      line-height: 1.8;
      border: 1px solid rgba(255,255,255,.10);
    }

    .msg.me {
      margin-left: auto;
      background: rgba(57,255,20,.10);
      border-color: rgba(57,255,20,.28);
    }

    .msg.bot {
      margin-right: auto;
      background: rgba(255,255,255,.03);
    }

    .chat-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .chat-row input {
      flex: 1;
    }

    .form-group label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .form-group input {
      width: 100%;
      padding: 12px 14px;
      background: rgba(255,255,255,.03);
      border: 1px solid var(--line);
      border-radius: 10px;
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
    }

    .form-group input:focus {
      outline: none;
      border-color: rgba(57,255,20,.4);
    }

    .hint {
      margin-top: 12px;
      font-size: 12px;
      color: var(--muted2);
      line-height: 1.9;
    }

    .mini-link {
      display: inline-block;
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      border-bottom: 1px dashed rgba(255,255,255,.22);
      text-decoration: none;
    }

    .mini-link:hover { color: var(--text); border-bottom-color: rgba(57,255,20,.45); }

    footer {
      background: #000;
      padding: 24px 0 100px;
      border-top: 1px solid var(--line);
      text-align: center;
    }
    .footer-brand { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
    .footer-copy { font-size: 11px; color: var(--muted2); }
    .footer-links { display: flex; justify-content: center; gap: 10px; margin-top: 16px; flex-wrap: wrap; }
    .footer-links a {
      padding: 8px 14px;
      border: 1px solid var(--line);
      border-radius: 8px;
      font-size: 12px;
      color: var(--muted);
      text-decoration: none;
    }

    .mobile-nav {
      position: fixed;
      left: 10px;
      right: 10px;
      bottom: 10px;
      z-index: 200;
      display: none;
    }
    .mobile-nav-bar {
      background: rgba(5,6,7,.92);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 18px;
      padding: 8px;
      display: flex;
      gap: 6px;
    }
    .mobile-nav-bar a {
      flex: 1;
      text-align: center;
      padding: 10px 6px;
      border-radius: 12px;
      background: rgba(0,0,0,.3);
      border: 1px solid rgba(255,255,255,.06);
      font-size: 10px;
      color: var(--muted);
      text-decoration: none;
    }
    .mobile-nav-bar a.active {
      border-color: rgba(57,255,20,.35);
      color: var(--text);
    }

    @media (max-width: 768px) {
      .navlinks { display: none; }
      .mobile-nav { display: block; }
      section { padding: 35px 0; }
    }

    @media (max-width: 480px) {
      .wrap { padding: 0 14px; }
      .card { padding: 20px 16px; }
      .feature-card { padding: 18px 14px; }
      .chat-row { flex-direction: column; }
    }

    .reveal { opacity: 0; transform: translateY(25px) scale(0.98); transition: all 0.7s cubic-bezier(.4,0,.2,1); }
    .reveal.visible { opacity: 1; transform: translateY(0) scale(1); }

    .h1 {
      background: linear-gradient(90deg, var(--text) 0%, rgba(57,255,20,.7) 25%, var(--text) 50%, rgba(57,255,20,.5) 75%, var(--text) 100%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 6s linear infinite;
    }

    .feature-card { position: relative; }
    .feature-card::before {
      content: ""; position: absolute; inset: -1px;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(57,255,20,.15), transparent 40%, transparent 60%, rgba(57,255,20,.1));
      opacity: 0; transition: opacity 0.4s; z-index: -1; pointer-events: none;
    }
    .feature-card:hover::before { opacity: 1; }
    .feature-card:hover { box-shadow: 0 8px 32px rgba(57,255,20,.08); transform: translateY(-4px); }

    .feature-card .emoji { display: inline-block; animation: floatUp 3s ease-in-out infinite; }
    .feature-card:nth-child(2) .emoji { animation-delay: 0.5s; }
    .feature-card:nth-child(3) .emoji { animation-delay: 1s; }

    .btn.primary { position: relative; overflow: hidden; }
    .btn.primary::after {
      content: ""; position: absolute; inset: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.15), transparent);
      transform: translateX(-100%); transition: transform 0.6s;
    }
    .btn.primary:hover::after { transform: translateX(100%); }
    .btn.primary:hover { box-shadow: 0 6px 25px rgba(57,255,20,.35); }

    .btn.ghost:hover { box-shadow: 0 4px 20px rgba(255,255,255,.05); background: rgba(255,255,255,.05); }

    .chip { transition: all 0.3s; }
    .chip:hover { border-color: rgba(57,255,20,.3); box-shadow: 0 0 15px rgba(57,255,20,.1); }

    .hero::before { animation: gradientShift 8s ease infinite; background-size: 200% 200%; }

    .form-card { transition: all 0.4s; }
    .form-card:hover { border-color: rgba(57,255,20,.15); }

    .form-group input:focus { box-shadow: 0 0 15px rgba(57,255,20,.08); }

    .msg.me { transition: all 0.3s; }
    .msg.bot { transition: all 0.3s; }

    .footer-links a { transition: all 0.3s; }
    .footer-links a:hover { border-color: rgba(57,255,20,.3); color: var(--text); transform: translateY(-1px); }

    .mobile-nav-bar a { transition: all 0.3s; }
    .mobile-nav-bar a.active { box-shadow: 0 0 12px rgba(57,255,20,.15); }
  </style>
  <script src="assets/js/ix-live-content.js" defer></script>
</head>
<body>
  <header>
    <div class="wrap">
      <nav class="nav">
        <div class="brand"><img src="assets/brands/infinitex-logo.png" alt="INFINITEX" data-ix-src="global.media.infinitexLogo" /></div>
        <div class="navlinks">
          <a href="index.html" data-ix-text="global.nav.home" data-ix-permission="permissions.showHome">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
          <a href="track.html" class="active" data-ix-text="global.nav.track" data-ix-permission="permissions.showTrack">ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</a>
          <a href="returns.html" data-ix-text="global.nav.returns" data-ix-permission="permissions.showReturns">Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a>
          <a href="products.html" data-ix-text="global.nav.products" data-ix-permission="permissions.showProducts">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
          <a href="contact.html">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
        </div>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="wrap">
        <div class="hero-content">
          <div class="chip" id="ix-track-badge" data-ix-chip="pages.track.badge"><span class="dot"></span> ØªØªØ¨Ø¹ ÙÙˆØ±ÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</div>
          <h1 class="h1" id="ix-track-title" data-ix-html="pages.track.title" style="margin-top: 16px;">ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø©<br/>Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ÙˆØ®Ù„Ø§Øµ</h1>
          <p class="hero-subtitle" id="ix-track-desc" data-ix-text="pages.track.desc">Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ù„Ø£Ø³ÙÙ„ ÙˆØ§Ù„Ù†ØªÙŠØ¬Ø© ØªØ·Ù„Ø¹ Ù„Ùƒ ÙÙˆØ±Ø§Ù‹ Ø¯Ø§Ø®Ù„ Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø©.</p>
        </div>
      </div>
    </section>

    <section class="reveal">
      <div class="wrap">
        <div class="form-card">
          <div id="chatLog" class="chat-log" aria-live="polite">
            <div class="msg bot" id="ix-track-intro" data-ix-text="pages.track.intro">Ø£Ù‡Ù„Ø§Ù‹! Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø·Ù„Ø¨Ùƒ ÙˆØ³Ø£Ø±Ø³Ù„ Ù„Ùƒ Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø­Ù†Ø© ÙˆØ±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù† ÙˆØ¬Ø¯.</div>
          </div>

          <div class="chat-row">
            <div class="form-group" style="flex:1;">
              <label for="order" id="ix-track-orderLabel">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</label>
              <input id="order" name="order" inputmode="numeric" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø«Ø§Ù„: 12345)" aria-label="Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨" data-ix-placeholder="pages.track.orderPlaceholder" />
            </div>
            <button class="btn primary" type="button" id="sendBtn" data-ix-text="pages.track.cta">ØªØªØ¨Ø¹</button>
          </div>

          <p class="hint" id="ix-track-hint" data-ix-text="pages.track.hint">Ø¥Ø°Ø§ Ø¹Ù†Ø¯Ùƒ Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø± Ø¥Ø¶Ø§ÙÙŠØŒ ØªÙ‚Ø¯Ø± ØªÙØªØ­ Ø§Ù„Ø´Ø§Øª Ù…Ù† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ ÙŠÙ…ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø©.</p>
          <a class="mini-link" href="#" id="openWidgetLink" data-ix-text="pages.track.openChat">ÙØªØ­ Ø´Ø§Øª Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
        </div>
      </div>
    </section>

    <section class="reveal">
      <div class="wrap">
        <div class="section-header">
          <h2 class="h2">Ù„ÙŠØ´ Ø§Ù„ØªØªØ¨Ø¹ Ø¹Ù†Ø¯Ù†Ø§ Ù…Ø®ØªÙ„ÙØŸ</h2>
        </div>
        <div class="feature-grid">
          <div class="feature-card">
            <div class="emoji">âš¡</div>
            <h3>Ø±Ø¯ ÙÙˆØ±ÙŠ</h3>
            <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ ÙˆØªØ´ÙˆÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†Ù.</p>
          </div>
          <div class="feature-card">
            <div class="emoji">ğŸ¤–</div>
            <h3>Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
            <p>Ø§Ù„Ø±Ø¯ÙˆØ¯ ÙˆØ§Ø¶Ø­Ø© ÙˆØªØ¹Ø±Ø¶ Ù„Ùƒ ÙƒÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©.</p>
          </div>
          <div class="feature-card">
            <div class="emoji">ğŸ”’</div>
            <h3>Ø®ØµÙˆØµÙŠØ© ÙƒØ§Ù…Ù„Ø©</h3>
            <p>Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ØªØ³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ù„Ø®Ø¯Ù…Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="closing">
      <div class="wrap" style="text-align:center;">
        <p class="closing-text">ØªØ¨ÙŠ ØªØ±Ø¬Ø¹ Ù„ØµÙØ­Ø© Ø§Ù„Ø®Ø¯Ù…Ø§ØªØŸ</p>
        <a href="index.html" class="btn ghost" style="max-width: 260px; margin: 0 auto;">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø®Ø¯Ù…Ø§Øª</a>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <div class="footer-brand">INFINITEX</div>
      <p class="footer-copy">Â© <span id="year"></span> INFINITEX. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
      <div class="footer-links">
        <a href="https://infinitex.sa/" target="_blank" data-ix-href="global.links.store" data-ix-text="global.nav.store">Ø§Ù„Ù…ØªØ¬Ø±</a>
        <a href="https://infinitex.sa/blogs/gold-warranty-policy" target="_blank" data-ix-href="global.links.warrantyPolicy" data-ix-text="global.nav.policy">Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø°Ù‡Ø¨ÙŠ</a>
      </div>
    </div>
  </footer>

  <div class="mobile-nav" role="navigation" aria-label="ØªÙ†Ù‚Ù„ Ø³Ø±ÙŠØ¹">
    <div class="mobile-nav-bar">
      <a href="index.html" data-ix-text="global.mobileNav.services" data-ix-permission="permissions.showHome">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="track.html" class="active" data-ix-text="global.mobileNav.track" data-ix-permission="permissions.showTrack">ØªØªØ¨Ø¹</a>
      <a href="returns.html" data-ix-text="global.mobileNav.returns" data-ix-permission="permissions.showReturns">Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a>
      <a href="products.html" data-ix-text="global.mobileNav.products" data-ix-permission="permissions.showProducts">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
      <a href="contact.html">ØªÙˆØ§ØµÙ„</a>
    </div>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const POPCORN_PROXY_URL = '/api/track';

    const chatLog = document.getElementById('chatLog');
    const orderInput = document.getElementById('order');
    const sendBtn = document.getElementById('sendBtn');

    const userId = (function(){
      const k = 'ix_popcorn_uid';
      const v = localStorage.getItem(k);
      if(v) return v;
      const nv = (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());
      localStorage.setItem(k, nv);
      return nv;
    })();

    function addMsg(role, text){
      const el = document.createElement('div');
      el.className = 'msg ' + (role === 'me' ? 'me' : 'bot');
      el.textContent = text;
      chatLog.appendChild(el);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function cleanBotText(input){
      const s = (input ?? '').toString();
      if(!s) return '';
      const marker = '}"';
      const idx = s.lastIndexOf(marker);
      if(idx !== -1){
        let tail = s.slice(idx + marker.length);
        tail = tail.replace(/^["\s]+/, '');
        if(/[A-Za-zØ€-Û¿]/.test(tail)) return tail.trim();
      }
      return s
        .replace(/^\s*\[.*?\]\s*/s, '')
        .replace(/^\s*"\s*\{.*?\}\s*"\s*/s, '')
        .trim();
    }

    async function sendOrder(){
      const orderNo = (orderInput.value || '').trim();
      if(!orderNo){
        addMsg('bot', 'Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹.');
        return;
      }

      addMsg('me', `Ø±Ù‚Ù… Ø·Ù„Ø¨ÙŠ: ${orderNo}`);
      orderInput.value = '';

      sendBtn.disabled = true;
      const thinking = document.createElement('div');
      thinking.className = 'msg bot';
      thinking.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØªØ¨Ø¹...';
      chatLog.appendChild(thinking);
      chatLog.scrollTop = chatLog.scrollHeight;

      try{
        const res = await fetch(POPCORN_PROXY_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ order: orderNo })
        });

        const data = await res.json().catch(()=> ({}));
        thinking.remove();

        if(!res.ok){
          addMsg('bot', data?.error || 'Ø­ØµÙ„ Ø®Ø·Ø£ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„ØªØªØ¨Ø¹. Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.');
          return;
        }
        addMsg('bot', cleanBotText(data?.response) || 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ØŒ Ù„ÙƒÙ† Ù„Ù… ÙŠØµÙ„ Ø±Ø¯ ÙˆØ§Ø¶Ø­. Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.');
      }catch(e){
        thinking.remove();
        addMsg('bot', 'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„ØªØªØ¨Ø¹. Ø¬Ø±Ù‘Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.');
      }finally{
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener('click', sendOrder);
    orderInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') sendOrder(); });

    function findLauncher(){
      const els = Array.from(document.querySelectorAll('body *'));
      const topNav = document.querySelector('.mobile-nav')?.getBoundingClientRect().top ?? null;
      const cands = els.filter(el=>{
        if(!el || el === document.body || el === document.documentElement) return false;
        if(el.closest && el.closest('.mobile-nav')) return false;
        const st = getComputedStyle(el);
        if(st.position !== 'fixed') return false;
        const r = el.getBoundingClientRect();
        if(r.width < 24 || r.height < 24) return false;
        if(r.width > 360 || r.height > 360) return false;
        if(r.left < window.innerWidth * 0.35) return false;
        if(r.top < window.innerHeight * 0.35) return false;
        if(topNav !== null && r.bottom <= (topNav - 2)) return false;
        if(el.tagName === 'IFRAME') return true;
        if(el.querySelector && el.querySelector('iframe')) return true;
        if(['BUTTON','A'].includes(el.tagName)) return true;
        if(el.getAttribute && el.getAttribute('role') === 'button') return true;
        if(st.cursor === 'pointer') return true;
        return false;
      });
      if(!cands.length) return null;
      cands.sort((a,b)=>{
        const ra=a.getBoundingClientRect(), rb=b.getBoundingClientRect();
        const areaA=ra.width*ra.height, areaB=rb.width*rb.height;
        const distA=(window.innerWidth-ra.right)**2 + (window.innerHeight-ra.bottom)**2;
        const distB=(window.innerWidth-rb.right)**2 + (window.innerHeight-rb.bottom)**2;
        return (areaA+distA) - (areaB+distB);
      });
      return cands[0];
    }

    document.getElementById('openWidgetLink')?.addEventListener('click', (e)=>{
      e.preventDefault();
      const el = findLauncher();
      if(el){ try{ el.click(); }catch(_){} }
    });

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
  </script>
</body>
</html>
